function refreshForm(innerHTML) {
  const newAddressForm = document.querySelector('#address-form-body');
  newAddressForm.innerHTML = innerHTML;
}

function addAddress(addressHTML) {
  const addresses = document.querySelector('.addresses');
  addresses.insertAdjacentHTML('beforeend', addressHTML);
}

function closeForm() {
 document.getElementById('close-address').click();
}

function autocomplete() {
  const flatAddresses = document.querySelectorAll('.autocomplete');
  if (flatAddresses.length > 0) {
    flatAddresses.forEach((flatAddress) => {
      const autocomplete = new google.maps.places.Autocomplete(flatAddress, { types: [ 'geocode' ] });
      google.maps.event.addDomListener(flatAddress, 'keydown', function(e) {
        if (e.key === "Enter") {
          e.preventDefault(); // Do not submit the form on Enter.
        }
      });
    });
  }
}

<% if @address.errors.any? %>
  refreshForm('<%= j render "spot_searches/form", address: @address %>');
<% else %>
  closeForm();
  addAddress('<%= j render "spot_searches/address", address: @address %>');
  refreshForm('<%= j render "spot_searches/form", address: Address.new %>');
<% end %>
autocomplete();

